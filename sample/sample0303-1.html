<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ドラゴンボールキャラクター一覧</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #e6e6e6;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: #ccd7e0;
    }
    .header {
      background-color: #1a5b8e;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .date-container {
      background-color: white;
      padding: 10px;
      border: 1px solid #cccccc;
    }
    .date {
      margin: 5px 0;
      color: #0066cc;
    }
    .section-header {
      background-color: #3e4a57;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .edit-button {
      background-color: #f2f2f2;
      border: 1px solid #cccccc;
      padding: 2px 10px;
      border-radius: 3px;
      color: black;
      cursor: pointer;
    }
    .section-title {
      flex: 1;
    }
    .section-title-input {
      background-color: white;
      border: 1px solid #aaa;
      padding: 2px 5px;
      border-radius: 3px;
      flex: 1;
      margin-right: 10px;
      color: black;
    }
    .character-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      padding: 10px;
      background-color: #d6e0e8;
      min-height: 180px;
    }
    .character {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      cursor: move;
      background-color: #f2f2f2;
      border: 1px solid #cccccc;
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .droppable {
      border: 2px dashed transparent;
      transition: border 0.3s;
    }
    
    .droppable.drag-over {
      border: 2px dashed #3388cc;
      background-color: rgba(51, 136, 204, 0.1);
    }
    .character-icon {
      width: 60px;
      height: 60px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 5px;
      font-size: 20px;
      color: white;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    }
    .character-name {
      text-align: center;
      font-size: 12px;
      margin-top: 5px;
    }
    .x-on-button {
      position: absolute;
      color: red;
      font-size: 32px;
      font-weight: bold;
      top: -15px;
      right: 5px;
      z-index: 100;
    }
    .bottom-section {
      background-color: #295c87;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .button {
      background-color: #f2f2f2;
      border: 1px solid #cccccc;
      padding: 5px 10px;
      border-radius: 3px;
      color: black;
      cursor: pointer;
    }
    .related-characters {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      padding: 10px;
      background-color: #d6e0e8;
    }
    .circle-highlight {
      position: absolute;
      width: 100px;
      height: 100px;
      border: 5px solid #ff6600;
      border-radius: 50%;
      top: -10px;
      left: -10px;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ヘッダー部分 -->
    <div class="header">
      <div>更新履歴</div>
      <div class="new-list-button" style="background-color: white; padding: 3px 8px; border-radius: 3px; color: black; font-size: 12px; position: relative;">
        新規リスト
        <span class="x-on-button">×</span>
      </div>
    </div>

    <!-- 日付表示部分 -->
    <div class="date-container">
      <div class="date">2025-02-10 13:24:19</div>
      <div class="date">2025-02-10 13:41:20</div>
    </div>

    <!-- Z戦士セクション -->
    <div class="section-header">
      <div class="section-title" id="z-title">Z戦士</div>
      <button class="edit-button" onclick="toggleEdit('z-title')">編集</button>
    </div>

    <div class="character-grid">
      <!-- キャラクター一覧 -->
      <div class="character">
        <div class="character-icon" style="background-color: #FF9933;">悟空</div>
        <div class="character-name">孫悟空（少年）</div>
      </div>
      
      <div class="character">
        <div class="character-icon" style="background-color: #FF9933;">悟空</div>
        <div class="character-name">孫悟空</div>
      </div>
      
      <div class="character">
        <div class="character-icon" style="background-color: #FF9933;">悟空</div>
        <div class="character-name">孫悟空（少年）</div>
      </div>
      
      <div class="character">
        <div class="character-icon" style="background-color: #FF9933;">悟天</div>
        <div class="character-name">孫悟天</div>
      </div>
      
      <div class="character">
        <div class="character-icon" style="background-color: #CCCCFF;">餃子</div>
        <div class="character-name">餃子</div>
      </div>
      
      <div class="character">
        <div class="character-icon" style="background-color: #5599FF;">悟飯</div>
        <div class="character-name">孫悟飯</div>
      </div>
      
      <div class="character">
        <div class="character-icon" style="background-color: #CC9966;">ヤム</div>
        <div class="character-name">ヤムチャ</div>
      </div>
      
      <div class="character">
        <div class="character-icon" style="background-color: #FF6666;">クリ</div>
        <div class="character-name">クリリン</div>
      </div>
      
      <div class="character">
        <div class="character-icon" style="background-color: #9966CC;">未来</div>
        <div class="character-name">トランクス（未来）</div>
      </div>
    </div>

    <!-- 敵セクション -->
    <div class="section-header">
      <div class="section-title" id="enemy-title">敵</div>
      <button class="edit-button" onclick="toggleEdit('enemy-title')">編集</button>
    </div>

    <div class="character-grid">
      <!-- 敵キャラクターは削除されました -->
    </div>

    <!-- ここに新しいグループが追加されます -->
    <div id="new-groups-container"></div>

    <!-- 関連キャラクターセクション -->
    <div class="bottom-section">
      <div class="section-title" id="related-title">関連キャラクター</div>
      <div style="display: flex; gap: 5px;">
        <div class="button" id="new-group-btn" onclick="showNewGroupForm()">新規グループ</div>
        <div class="button">関連するキャラクタを登録</div>
      </div>
    </div>
    
    <div id="new-group-form" style="display: none; padding: 15px; background-color: #d6e0e8;">
      <div style="display: flex; margin-bottom: 15px;">
        <input type="text" id="new-group-name" placeholder="グループ名を入力 例:嫁リスト" style="flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
        <button onclick="createNewGroup()" style="background-color: #1a5b8e; color: white; border: none; padding: 8px 20px; margin-left: 10px; border-radius: 4px; cursor: pointer;">新規グループを作成</button>
      </div>
    </div>

    <div class="related-characters character-grid">
      <div class="character">
        <div class="character-icon" style="background-color: #33CC66;">セル</div>
        <div class="character-name">セル</div>
      </div>
      
      <div class="character">
        <div class="character-icon" style="background-color: #9999FF;">フリ</div>
        <div class="character-name">フリーザ</div>
      </div>
      
      <div class="character">
        <div class="character-icon" style="background-color: #FF99CC;">桃白</div>
        <div class="character-name">桃白白</div>
      </div>
      
      <div class="character">
        <div class="character-icon" style="background-color: #996633;">ナッパ</div>
        <div class="character-name">ナッパ</div>
      </div>
      
      <div class="character">
        <div class="character-icon" style="background-color: #66CCCC;">17号</div>
        <div class="character-name">人造人間17号</div>
      </div>
    </div>
    
    <!-- 検索セクション -->
    <div class="section-header">
      <div style="display: flex; align-items: center; flex: 1;">
        <div style="margin-right: 15px;">作品検索</div>
        <input type="text" placeholder="itemID" style="flex: 1; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; max-width: 200px;">
        <button style="background-color: #f2f2f2; border: 1px solid #cccccc; padding: 4px 12px; margin-left: 10px; border-radius: 3px; color: black; cursor: pointer;" onclick="showSearchResults()">検索</button>
      </div>
    </div>
    
    <div id="search-results" style="display: none; padding: 10px; background-color: #d6e0e8;">
      <div class="character-grid">
        <div class="character">
          <div class="character-icon" style="background-color: #FF9933;">キャラA</div>
          <div class="character-name">キャラクターA</div>
        </div>
        
        <div class="character">
          <div class="character-icon" style="background-color: #5599FF;">キャラB</div>
          <div class="character-name">キャラクターB</div>
        </div>
        
        <div class="character">
          <div class="character-icon" style="background-color: #33CC66;">キャラC</div>
          <div class="character-name">キャラクターC</div>
        </div>
        
        <div class="character">
          <div class="character-icon" style="background-color: #9999FF;">キャラD</div>
          <div class="character-name">キャラクターD</div>
        </div>
        
        <div class="character">
          <div class="character-icon" style="background-color: #FF99CC;">キャラE</div>
          <div class="character-name">キャラクターE</div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // ドラッグアンドドロップ機能の実装
    document.addEventListener('DOMContentLoaded', function() {
      const characters = document.querySelectorAll('.character');
      const characterGrids = document.querySelectorAll('.character-grid');
      const relatedCharacters = document.querySelector('.related-characters');
      
      // オリジナルの位置を保存するためのマップ
      const originalPositions = new Map();
      
      // 各キャラクターにドラッグイベントを追加
      characters.forEach((character, index) => {
        character.setAttribute('draggable', true);
        character.dataset.id = `char-${index}`;
        
        // オリジナルの親要素とインデックスを保存
        const parentElement = character.parentElement;
        const isRelated = parentElement.classList.contains('related-characters');
        originalPositions.set(character.dataset.id, {
          parent: parentElement,
          isRelated: isRelated
        });
        
        character.addEventListener('dragstart', function(e) {
          e.dataTransfer.setData('text/plain', character.innerHTML);
          e.dataTransfer.setData('application/json', JSON.stringify({
            id: character.dataset.id,
            isRelated: originalPositions.get(character.dataset.id).isRelated
          }));
          e.dataTransfer.effectAllowed = 'move';
          setTimeout(() => {
            character.classList.add('dragging');
          }, 0);
        });
        
        character.addEventListener('dragend', function() {
          character.classList.remove('dragging');
        });
      });
      
      // ドロップ領域の設定
      characterGrids.forEach(grid => {
        grid.classList.add('droppable');
        
        grid.addEventListener('dragover', function(e) {
          e.preventDefault();
          this.classList.add('drag-over');
        });
        
        grid.addEventListener('dragleave', function() {
          this.classList.remove('drag-over');
        });
        
        grid.addEventListener('drop', function(e) {
          e.preventDefault();
          this.classList.remove('drag-over');
          
          const data = e.dataTransfer.getData('text/plain');
          const jsonData = JSON.parse(e.dataTransfer.getData('application/json'));
          const draggingElement = document.querySelector(`[data-id="${jsonData.id}"]`);
          
          if (draggingElement) {
            // キャラクターを移動
            this.appendChild(draggingElement);
            
            // 移動先が関連キャラクターセクションであれば、「関連キャラクターに戻す」ボタンを追加
            if (this !== relatedCharacters && !jsonData.isRelated) {
              if (!draggingElement.querySelector('.return-button')) {
                const returnButton = document.createElement('button');
                returnButton.className = 'return-button';
                returnButton.textContent = '';
                returnButton.style.marginTop = '5px';
                returnButton.style.padding = '2px 8px';
                returnButton.style.fontSize = '11px';
                returnButton.style.backgroundColor = '#f0f0f0';
                returnButton.style.border = '1px solid #ccc';
                returnButton.style.borderRadius = '3px';
                returnButton.style.cursor = 'pointer';
                
                returnButton.addEventListener('click', function() {
                  // 関連キャラクターセクションに戻す
                  relatedCharacters.appendChild(draggingElement);
                  // ボタンを削除
                  this.remove();
                });
                
                draggingElement.appendChild(returnButton);
              }
            } else if (this === relatedCharacters) {
              // 関連キャラクターセクションに戻した場合、ボタンを削除
              const returnButton = draggingElement.querySelector('.return-button');
              if (returnButton) {
                returnButton.remove();
              }
            }
          }
        });
      });
    });
    
    // グループ名編集機能
    function toggleEdit(id) {
      const titleElement = document.getElementById(id);
      const currentTitle = titleElement.textContent;
      const button = titleElement.parentElement.querySelector('.edit-button');
      
      if (titleElement.tagName === 'DIV') {
        // 編集モードに切り替え
        const input = document.createElement('input');
        input.type = 'text';
        input.value = currentTitle;
        input.className = 'section-title-input';
        input.id = id;
        
        titleElement.parentNode.replaceChild(input, titleElement);
        button.textContent = '保存';
        input.focus();
      } else {
        // 表示モードに戻す
        const div = document.createElement('div');
        div.textContent = titleElement.value;
        div.className = 'section-title';
        div.id = id;
        
        titleElement.parentNode.replaceChild(div, titleElement);
        button.textContent = '編集';
      }
    }
    
    // 新規グループフォームの表示
    function showNewGroupForm() {
      const form = document.getElementById('new-group-form');
      if (form.style.display === 'none') {
        form.style.display = 'block';
      } else {
        form.style.display = 'none';
      }
    }
    
    // 検索結果の表示
    function showSearchResults() {
      const resultsContainer = document.getElementById('search-results');
      if (resultsContainer.style.display === 'none') {
        resultsContainer.style.display = 'block';
      } else {
        resultsContainer.style.display = 'none';
      }
    }
    
    // 新しいグループを作成する機能
    function createNewGroup() {
      // 入力フィールドからグループ名を取得
      const groupNameInput = document.getElementById('new-group-name');
      const groupName = groupNameInput.value.trim();
      
      // グループ名が空でないか確認
      if (groupName === '') {
        alert('グループ名を入力してください');
        return;
      }
      
      // グループIDを生成（タイムスタンプを使用）
      const groupId = 'group-' + Date.now();
      
      // 新しいセクションヘッダーを作成
      const sectionHeader = document.createElement('div');
      sectionHeader.className = 'section-header';
      sectionHeader.innerHTML = `
        <div class="section-title" id="${groupId}-title">${groupName}</div>
        <button class="edit-button" onclick="toggleEdit('${groupId}-title')">編集</button>
      `;
      
      // 新しいキャラクターグリッドを作成
      const characterGrid = document.createElement('div');
      characterGrid.className = 'character-grid droppable';
      characterGrid.id = `${groupId}-grid`;
      
      // 新しいグループをDOMに追加（敵セクションの後ろに）
      const newGroupsContainer = document.getElementById('new-groups-container');
      newGroupsContainer.appendChild(sectionHeader);
      newGroupsContainer.appendChild(characterGrid);
      
      // 現在の日付と時刻を更新履歴に追加
      const now = new Date();
      const dateStr = now.toISOString().replace('T', ' ').substring(0, 19);
      const dateContainer = document.querySelector('.date-container');
      const newDateDiv = document.createElement('div');
      newDateDiv.className = 'date';
      newDateDiv.textContent = dateStr;
      dateContainer.prepend(newDateDiv);
      
      // 入力フィールドをクリアしてフォームを非表示にする
      groupNameInput.value = '';
      document.getElementById('new-group-form').style.display = 'none';
      
      // 新しく追加されたドロップ領域にドラッグ&ドロップ機能を設定
      setupDragAndDrop(characterGrid);
    }
    
    // 新しいドロップ領域にドラッグ&ドロップ機能を設定する関数
    function setupDragAndDrop(grid) {
      const relatedCharacters = document.querySelector('.related-characters');
      
      grid.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('drag-over');
      });
      
      grid.addEventListener('dragleave', function() {
        this.classList.remove('drag-over');
      });
      
      grid.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('drag-over');
        
        const data = e.dataTransfer.getData('text/plain');
        const jsonData = JSON.parse(e.dataTransfer.getData('application/json'));
        const draggingElement = document.querySelector(`[data-id="${jsonData.id}"]`);
        
        if (draggingElement) {
          // キャラクターを移動
          this.appendChild(draggingElement);
          
          // 移動先が関連キャラクターセクションでなければ、「関連キャラクターに戻す」ボタンを追加
          if (this !== relatedCharacters && !jsonData.isRelated) {
            if (!draggingElement.querySelector('.return-button')) {
              const returnButton = document.createElement('button');
              returnButton.className = 'return-button';
              returnButton.textContent = '戻す';
              returnButton.style.marginTop = '5px';
              returnButton.style.padding = '2px 8px';
              returnButton.style.fontSize = '11px';
              returnButton.style.backgroundColor = '#f0f0f0';
              returnButton.style.border = '1px solid #ccc';
              returnButton.style.borderRadius = '3px';
              returnButton.style.cursor = 'pointer';
              
              returnButton.addEventListener('click', function() {
                // 関連キャラクターセクションに戻す
                relatedCharacters.appendChild(draggingElement);
                // ボタンを削除
                this.remove();
              });
              
              draggingElement.appendChild(returnButton);
            }
          } else if (this === relatedCharacters) {
            // 関連キャラクターセクションに戻した場合、ボタンを削除
            const returnButton = draggingElement.querySelector('.return-button');
            if (returnButton) {
              returnButton.remove();
            }
          }
        }
      });
    }
  </script>
</body>
</html>
