<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>最新アニメ一覧</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f0f2f5;
      color: #333;
      line-height: 1.6;
    }
    h1, h2 {
      text-align: center;
      color: #2e51a2;
      margin-bottom: 30px;
      font-weight: 700;
      position: relative;
      padding-bottom: 10px;
    }
    h1::after, h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 3px;
      background-color: #2e51a2;
      border-radius: 3px;
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      overflow: hidden;
      margin-bottom: 30px;
    }
    th {
      background-color: #2e51a2;
      color: white;
      padding: 15px 16px;
      text-align: left;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .detail-table thead th {
      background-color: #2e51a2;
      color: white;
    }
    td {
      padding: 14px 16px;
      border-bottom: 1px solid #eee;
      transition: background-color 0.2s;
    }
    tr:last-child td {
      border-bottom: none;
    }
    tr:hover td {
      background-color: #f5f8ff;
    }
    .loading {
      text-align: center;
      font-style: italic;
      color: #666;
      padding: 30px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .error {
      color: #e53935;
      text-align: center;
      padding: 20px;
      background-color: #ffebee;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .title-link {
      cursor: pointer;
      color: #3f51b5;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    .title-link:hover {
      color: #303f9f;
    }
    .english-title {
      display: block;
      margin-top: 5px;
      font-size: 0.9em;
      color: #666;
    }
    .neoapo-status {
      cursor: pointer;
      color: #3f51b5;
      padding: 5px 10px;
      border-radius: 4px;
      display: inline-block;
      transition: background-color 0.2s;
    }
    .neoapo-status:hover {
      background-color: #e8eaf6;
    }
    .neoapo-registered {
      color: #388e3c;
      font-weight: 500;
    }
    .dialog-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .dialog-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
      max-width: 400px;
      width: 90%;
    }
    .dialog-title {
      font-size: 1.2em;
      font-weight: 600;
      margin-bottom: 15px;
      color: #2e51a2;
    }
    .dialog-buttons {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
      gap: 10px;
    }
    .dialog-button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }
    .dialog-button-primary {
      background-color: #2e51a2;
      color: white;
    }
    .dialog-button-secondary {
      background-color: #e0e0e0;
      color: #333;
    }
    #back-button {
      background-color: #2e51a2;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    #back-button:hover {
      background-color: #1f3c7a;
    }
    .detail-table {
      margin-top: 20px;
    }
    .detail-table th {
      width: 180px;
      background-color: #e8eaf6;
      color: #303f9f;
    }
    .detail-table td {
      word-break: break-word;
      background-color: #ffffff;
    }
    .api-path-column {
      width: 180px;
      font-family: 'Consolas', monospace;
      color: #ffffff;
      font-size: 0.85em;
      background-color: #3f51b5 !important;
      padding-left: 12px !important;
    }
    .cover-image {
      width: 100%;
      max-width: 250px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      margin-bottom: 20px;
      display: block;
    }
    .cover-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 25px;
    }
    .anime-info-container {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      margin-top: 20px;
    }
    .anime-info-left {
      flex: 0 0 250px;
    }
    .anime-info-right {
      flex: 1;
      min-width: 300px;
    }
    .anime-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
    }
    .meta-item {
      background: #f0f4ff;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 0.9em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-left: 3px solid #3f51b5;
    }
    .thumbnail {
      width: 60px;
      height: 85px;
      object-fit: cover;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    @media (max-width: 768px) {
      .anime-info-container {
        flex-direction: column;
      }
      .anime-info-left, .anime-info-right {
        width: 100%;
      }
      table {
        font-size: 0.9em;
      }
      th, td {
        padding: 10px 12px;
      }
    }
  </style>
</head>
<body>
  <h1>anilist2neoapo</h1>
  <div id="anime-list">
    <p class="loading">データを読み込み中...</p>
  </div>
  
  <div id="anime-details" style="display: none;">
    <div class="back-button-container">
      <button id="back-button">← 一覧に戻る</button>
    </div>
    <h2 id="detail-title"></h2>
    <div id="detail-content"></div>
  </div>
  
  <!-- 登録確認ダイアログ -->
  <div id="registration-dialog" style="display: none;" class="dialog-overlay">
    <div class="dialog-content">
      <div class="dialog-title">登録確認</div>
      <p>このアニメをneoapoに新規登録しますか？</p>
      <div class="dialog-buttons">
        <button id="dialog-cancel" class="dialog-button dialog-button-secondary">キャンセル</button>
        <button id="dialog-confirm" class="dialog-button dialog-button-primary">はい</button>
      </div>
    </div>
  </div>

  <script>
    async function fetchLatestAnime() {
      const query = `
        query {
          Page(page: 1, perPage: 20) {
            media(type: ANIME, sort: ID_DESC) {
              id
              title {
                romaji
                english
                native
              }
              updatedAt
              startDate {
                year
                month
                day
              }
              format
              coverImage {
                large
                medium
              }
            }
          }
        }
      `;

      try {
        const response = await fetch('https://graphql.anilist.co', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({ query })
        });

        const data = await response.json();

        if (data.errors) {
          console.error('GraphQL エラー:', data.errors);
          throw new Error(data.errors[0].message);
        }
        if (!data.data) {
          throw new Error("APIからデータが返却されませんでした。");
        }
        return data.data.Page.media;
      } catch (error) {
        console.error('データ取得エラー:', error);
        throw error;
      }
    }
    
    async function fetchAnimeDetails(id) {
      const query = `
        query {
          Media(id: ${id}, type: ANIME) {
            id
            title {
              romaji
              english
              native
            }
            description
            startDate {
              year
              month
              day
            }
            endDate {
              year
              month
              day
            }
            episodes
            duration
            status
            season
            seasonYear
            format
            genres
            tags {
              name
              rank
              category
              description
            }
            averageScore
            meanScore
            popularity
            favourites
            trending
            nextAiringEpisode {
              episode
              airingAt
              timeUntilAiring
            }
            source
            hashtag
            synonyms
            countryOfOrigin
            isLicensed
            studios {
              nodes {
                name
                isAnimationStudio
              }
            }
            externalLinks {
              url
              site
              type
            }
            coverImage {
              large
              medium
            }
            bannerImage
            trailer {
              id
              site
              thumbnail
            }
            rankings {
              rank
              type
              context
              year
              season
            }
            staff {
              edges {
                role
                node {
                  name {
                    full
                    native
                  }
                }
              }
            }
            characters(sort: ROLE) {
              edges {
                role
                node {
                  name {
                    full
                    native
                  }
                }
              }
            }
            relations {
              edges {
                relationType
                node {
                  id
                  type
                  title {
                    romaji
                    native
                  }
                  format
                }
              }
            }
            updatedAt
          }
        }
      `;

      try {
        const response = await fetch('https://graphql.anilist.co', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({ query })
        });

        const data = await response.json();

        if (data.errors) {
          console.error('GraphQL エラー:', data.errors);
          throw new Error(data.errors[0].message);
        }
        if (!data.data) {
          throw new Error("APIからデータが返却されませんでした。");
        }
        return data.data.Media;
      } catch (error) {
        console.error('アニメ詳細取得エラー:', error);
        throw error;
      }
    }

    function displayAnimeList(animeList) {
      const container = document.getElementById('anime-list');
      
      if (!animeList || animeList.length === 0) {
        container.innerHTML = '<p class="error">アニメデータが見つかりませんでした。</p>';
        return;
      }

      const table = document.createElement('table');
      
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      // タイトル（英語タイトルと日本語タイトルを統合）、形式、更新日、放送日、neoapo の列を表示
      const headers = ['サムネイル', 'タイトル(日本語/英語)', '形式', '更新日', '放送日', 'neoapo'];
      
      headers.forEach(headerText => {
        const th = document.createElement('th');
        th.textContent = headerText;
        headerRow.appendChild(th);
      });
      
      thead.appendChild(headerRow);
      table.appendChild(thead);
      
      const tbody = document.createElement('tbody');
      
      animeList.forEach(anime => {
        const row = document.createElement('tr');
        
        // サムネイル
        const thumbnailCell = document.createElement('td');
        if (anime.coverImage && anime.coverImage.medium) {
          const thumbnail = document.createElement('img');
          thumbnail.className = 'thumbnail';
          thumbnail.src = anime.coverImage.medium;
          thumbnail.alt = anime.title.native || anime.title.romaji;
          thumbnail.loading = 'lazy';
          thumbnailCell.appendChild(thumbnail);
        } else {
          thumbnailCell.textContent = 'なし';
        }
        row.appendChild(thumbnailCell);
        
        // 日本語タイトルと英語タイトルを同じセルに2行で表示
        const titleCell = document.createElement('td');
        const titleContainer = document.createElement('div');
        
        // 日本語タイトル
        const japaneseTitleLink = document.createElement('span');
        japaneseTitleLink.className = 'title-link';
        japaneseTitleLink.textContent = anime.title.native || '日本語タイトルなし';
        japaneseTitleLink.dataset.id = anime.id;
        japaneseTitleLink.addEventListener('click', () => showAnimeDetails(anime.id));
        
        // 英語タイトル
        const englishTitleLink = document.createElement('span');
        englishTitleLink.className = 'title-link english-title';
        englishTitleLink.textContent = anime.title.english || anime.title.romaji || '英語タイトルなし';
        englishTitleLink.dataset.id = anime.id;
        englishTitleLink.addEventListener('click', () => showAnimeDetails(anime.id));
        
        titleContainer.appendChild(japaneseTitleLink);
        titleContainer.appendChild(englishTitleLink);
        titleCell.appendChild(titleContainer);
        row.appendChild(titleCell);
        
        // 形式
        const formatCell = document.createElement('td');
        const formatMap = {
          TV: 'TVアニメ',
          MOVIE: '映画',
          OVA: 'OVA',
          ONA: 'ONA',
          SPECIAL: 'スペシャル',
          MUSIC: 'ミュージック',
          MANGA: 'マンガ',
          NOVEL: '小説',
          ONE_SHOT: 'ワンショット'
        };
        formatCell.textContent = anime.format ? (formatMap[anime.format] || anime.format) : '-';
        row.appendChild(formatCell);
        
        // 更新日
        const updatedAtCell = document.createElement('td');
        if (anime.updatedAt) {
          const updatedDate = new Date(anime.updatedAt * 1000);
          updatedAtCell.textContent = updatedDate.toLocaleDateString('ja-JP', { 
            year: 'numeric', 
            month: '2-digit', 
            day: '2-digit' 
          });
        } else {
          updatedAtCell.textContent = '-';
        }
        row.appendChild(updatedAtCell);
        
        // 放送日
        const startDate = document.createElement('td');
        if (anime.startDate && anime.startDate.year) {
          startDate.textContent = `${anime.startDate.year}/${anime.startDate.month || '?'}/${anime.startDate.day || '?'}`;
        } else {
          startDate.textContent = '-';
        }
        row.appendChild(startDate);
        
        // neoapo
        const neoapo = document.createElement('td');
        const neoapoStatus = document.createElement('span');
        neoapoStatus.className = 'neoapo-status';
        neoapoStatus.textContent = '未登録';
        neoapoStatus.dataset.animeId = anime.id;
        neoapoStatus.addEventListener('click', showRegistrationDialog);
        neoapo.appendChild(neoapoStatus);
        row.appendChild(neoapo);
        
        tbody.appendChild(row);
      });
      
      table.appendChild(tbody);
      container.innerHTML = '';
      container.appendChild(table);
    }
    
    async function showAnimeDetails(animeId) {
      try {
        document.getElementById('detail-content').innerHTML = '<p class="loading">詳細データを読み込み中...</p>';
        document.getElementById('anime-list').style.display = 'none';
        document.getElementById('anime-details').style.display = 'block';
        
        const animeDetails = await fetchAnimeDetails(animeId);
        document.getElementById('detail-title').textContent = animeDetails.title.native || animeDetails.title.romaji;
        
        const detailContent = document.getElementById('detail-content');
        detailContent.innerHTML = '';
        
        const animeInfoContainer = document.createElement('div');
        animeInfoContainer.className = 'anime-info-container';
        
        const animeInfoLeft = document.createElement('div');
        animeInfoLeft.className = 'anime-info-left';
        
        if (animeDetails.coverImage && animeDetails.coverImage.large) {
          const coverContainer = document.createElement('div');
          coverContainer.className = 'cover-container';
          
          const coverImage = document.createElement('img');
          coverImage.className = 'cover-image';
          coverImage.src = animeDetails.coverImage.large;
          coverImage.alt = animeDetails.title.native || animeDetails.title.romaji;
          coverContainer.appendChild(coverImage);
          
          animeInfoLeft.appendChild(coverContainer);
        }
        
        animeInfoContainer.appendChild(animeInfoLeft);
        
        const animeInfoRight = document.createElement('div');
        animeInfoRight.className = 'anime-info-right';
        
        const detailTable = document.createElement('table');
        detailTable.className = 'detail-table';
        
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        
        const apiPathHeader = document.createElement('th');
        apiPathHeader.textContent = 'APIパス';
        apiPathHeader.className = 'api-path-column';
        headerRow.appendChild(apiPathHeader);
        
        const labelHeader = document.createElement('th');
        labelHeader.textContent = '項目';
        headerRow.appendChild(labelHeader);
        
        const valueHeader = document.createElement('th');
        valueHeader.textContent = '値';
        headerRow.appendChild(valueHeader);
        
        thead.appendChild(headerRow);
        detailTable.appendChild(thead);
        
        const tbody = document.createElement('tbody');
        
        addDetailRow(tbody, 'ID', animeDetails.id, 'Media.id');
        addDetailRow(tbody, 'タイトル（日本語）', animeDetails.title.native || '-', 'Media.title.native');
        addDetailRow(tbody, 'タイトル（英語）', animeDetails.title.english || '-', 'Media.title.english');
        addDetailRow(tbody, 'タイトル（ローマ字）', animeDetails.title.romaji || '-', 'Media.title.romaji');
        
        let coverImageUrl = '-';
        if (animeDetails.coverImage && animeDetails.coverImage.large) {
          coverImageUrl = animeDetails.coverImage.large;
        }
        addDetailRow(tbody, 'カバー画像URL', coverImageUrl, 'Media.coverImage.large');
        addDetailRow(tbody, '説明', animeDetails.description || '-', 'Media.description');
        
        let startDateText = '-';
        if (animeDetails.startDate && animeDetails.startDate.year) {
          startDateText = `${animeDetails.startDate.year}/${animeDetails.startDate.month || '?'}/${animeDetails.startDate.day || '?'}`;
        }
        addDetailRow(tbody, '放送開始日', startDateText, 'Media.startDate');
        
        let endDateText = '-';
        if (animeDetails.endDate && animeDetails.endDate.year) {
          endDateText = `${animeDetails.endDate.year}/${animeDetails.endDate.month || '?'}/${animeDetails.endDate.day || '?'}`;
        }
        addDetailRow(tbody, '放送終了日', endDateText, 'Media.endDate');
        
        addDetailRow(tbody, 'エピソード数', animeDetails.episodes || '-', 'Media.episodes');
        addDetailRow(tbody, '時間（分）', animeDetails.duration || '-', 'Media.duration');
        
        const statusMap = {
          FINISHED: '完結',
          RELEASING: '放送中',
          NOT_YET_RELEASED: '未放送',
          CANCELLED: '中止'
        };
        addDetailRow(tbody, 'ステータス', statusMap[animeDetails.status] || animeDetails.status || '-', 'Media.status');
        
        const seasonMap = {
          WINTER: '冬',
          SPRING: '春',
          SUMMER: '夏',
          FALL: '秋'
        };
        let seasonText = '-';
        if (animeDetails.season) {
          seasonText = `${seasonMap[animeDetails.season] || animeDetails.season} ${animeDetails.seasonYear || ''}`;
        }
        addDetailRow(tbody, 'シーズン', seasonText, 'Media.season / Media.seasonYear');
        
        const formatMap = {
          TV: 'TVアニメ',
          MOVIE: '映画',
          OVA: 'OVA',
          ONA: 'ONA',
          SPECIAL: 'スペシャル',
          MUSIC: 'ミュージック',
          MANGA: 'マンガ',
          NOVEL: '小説',
          ONE_SHOT: 'ワンショット'
        };
        addDetailRow(tbody, '形式', formatMap[animeDetails.format] || animeDetails.format || '-', 'Media.format');
        
        const genres = animeDetails.genres && animeDetails.genres.length > 0 ? animeDetails.genres.join(', ') : '-';
        addDetailRow(tbody, 'ジャンル', genres, 'Media.genres');
        
        const tags = animeDetails.tags && animeDetails.tags.length > 0 ? 
          animeDetails.tags.map(tag => tag.name).join(', ') : '-';
        addDetailRow(tbody, 'タグ', tags, 'Media.tags.name');
        
        const studios = animeDetails.studios && animeDetails.studios.nodes.length > 0 ? 
          animeDetails.studios.nodes.map(studio => studio.name).join(', ') : '-';
        addDetailRow(tbody, '制作会社', studios, 'Media.studios.nodes.name');
        
        let updatedAtText = '-';
        if (animeDetails.updatedAt) {
          const updatedDate = new Date(animeDetails.updatedAt * 1000);
          updatedAtText = updatedDate.toLocaleDateString('ja-JP', { 
            year: 'numeric', 
            month: '2-digit', 
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          });
        }
        addDetailRow(tbody, '更新日', updatedAtText, 'Media.updatedAt');
        
        // バナー画像の表示
        if (animeDetails.bannerImage) {
          const bannerContainer = document.createElement('div');
          bannerContainer.style.marginBottom = '20px';
          
          const bannerImage = document.createElement('img');
          bannerImage.src = animeDetails.bannerImage;
          bannerImage.alt = 'バナー画像';
          bannerImage.style.width = '100%';
          bannerImage.style.borderRadius = '8px';
          bannerImage.style.boxShadow = '0 4px 8px rgba(0,0,0,0.15)';
          
          bannerContainer.appendChild(bannerImage);
          detailContent.insertBefore(bannerContainer, animeInfoContainer);
        }

        // 原作情報
        const sourceMap = {
          ORIGINAL: 'オリジナル',
          MANGA: '漫画',
          LIGHT_NOVEL: 'ライトノベル',
          VISUAL_NOVEL: 'ビジュアルノベル',
          VIDEO_GAME: 'ビデオゲーム',
          OTHER: 'その他',
          NOVEL: '小説',
          DOUJINSHI: '同人誌',
          ANIME: 'アニメ',
          WEB_NOVEL: 'ウェブ小説',
          LIVE_ACTION: '実写',
          GAME: 'ゲーム',
          COMIC: 'コミック',
          MULTIMEDIA_PROJECT: 'メディアミックス',
          PICTURE_BOOK: '絵本'
        };
        addDetailRow(tbody, '原作', sourceMap[animeDetails.source] || animeDetails.source || '-', 'Media.source');

        // 公式サイト
        if (animeDetails.externalLinks && animeDetails.externalLinks.length > 0) {
          const linksCell = document.createElement('td');
          
          animeDetails.externalLinks.forEach((link, index) => {
            const linkElem = document.createElement('a');
            linkElem.href = link.url;
            linkElem.textContent = link.site;
            linkElem.target = '_blank';
            linkElem.style.marginRight = '10px';
            linkElem.style.color = '#3f51b5';
            
            linksCell.appendChild(linkElem);
            
            if (index < animeDetails.externalLinks.length - 1) {
              linksCell.appendChild(document.createTextNode(' | '));
            }
          });
          
          const row = document.createElement('tr');
          
          const apiPathCell = document.createElement('td');
          apiPathCell.className = 'api-path-column';
          apiPathCell.textContent = 'Media.externalLinks';
          row.appendChild(apiPathCell);
          
          const labelCell = document.createElement('th');
          labelCell.textContent = '公式サイト';
          row.appendChild(labelCell);
          
          row.appendChild(linksCell);
          tbody.appendChild(row);
        }

        // 予告編
        if (animeDetails.trailer && animeDetails.trailer.id) {
          const trailerRow = document.createElement('tr');
          
          const apiPathCell = document.createElement('td');
          apiPathCell.className = 'api-path-column';
          apiPathCell.textContent = 'Media.trailer';
          trailerRow.appendChild(apiPathCell);
          
          const labelCell = document.createElement('th');
          labelCell.textContent = '予告編';
          trailerRow.appendChild(labelCell);
          
          const trailerCell = document.createElement('td');
          if (animeDetails.trailer.site === 'youtube') {
            const iframe = document.createElement('iframe');
            iframe.width = '100%';
            iframe.height = '315';
            iframe.src = `https://www.youtube.com/embed/${animeDetails.trailer.id}`;
            iframe.frameBorder = '0';
            iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
            iframe.allowFullscreen = true;
            
            trailerCell.appendChild(iframe);
          } else {
            trailerCell.textContent = '非対応の動画サイト';
          }
          trailerRow.appendChild(trailerCell);
          tbody.appendChild(trailerRow);
        }

        detailTable.appendChild(tbody);
        animeInfoRight.appendChild(detailTable);
        
        animeInfoContainer.appendChild(animeInfoRight);
        detailContent.appendChild(animeInfoContainer);
      } catch (error) {
        document.getElementById('detail-content').innerHTML = `<p class="error">詳細データの取得中にエラーが発生しました: ${error.message}</p>`;
      }
    }
    
    function addDetailRow(tbody, label, value, apiPath) {
      const row = document.createElement('tr');
      
      const apiPathCell = document.createElement('td');
      apiPathCell.className = 'api-path-column';
      apiPathCell.textContent = apiPath || '-';
      row.appendChild(apiPathCell);
      
      const labelCell = document.createElement('th');
      labelCell.textContent = label;
      row.appendChild(labelCell);
      
      const valueCell = document.createElement('td');
      if (typeof value === 'string' && value.startsWith('<') && value.endsWith('>')) {
        valueCell.innerHTML = value;
      } else {
        valueCell.textContent = value;
      }
      row.appendChild(valueCell);
      
      tbody.appendChild(row);
    }
    
    document.getElementById('back-button').addEventListener('click', () => {
      document.getElementById('anime-details').style.display = 'none';
      document.getElementById('anime-list').style.display = 'block';
    });
    
    let currentAnimeId = null;
    
    function showRegistrationDialog(event) {
      if (event.target.classList.contains('neoapo-registered')) {
        return;
      }
      
      currentAnimeId = event.target.dataset.animeId;
      document.getElementById('registration-dialog').style.display = 'flex';
    }
    
    document.getElementById('dialog-confirm').addEventListener('click', () => {
      document.getElementById('registration-dialog').style.display = 'none';
      
      if (currentAnimeId) {
        const statusElements = document.querySelectorAll('.neoapo-status');
        statusElements.forEach(element => {
          if (element.dataset.animeId === currentAnimeId) {
            element.textContent = '登録済み';
            element.classList.add('neoapo-registered');
          }
        });
        currentAnimeId = null;
      }
    });
    
    document.getElementById('dialog-cancel').addEventListener('click', () => {
      document.getElementById('registration-dialog').style.display = 'none';
      currentAnimeId = null;
    });

    fetchLatestAnime()
      .then(animeList => {
        displayAnimeList(animeList);
      })
      .catch(error => {
        const container = document.getElementById('anime-list');
        container.innerHTML = `<p class="error">データの取得中にエラーが発生しました: ${error.message}</p>`;
      });
  </script>
</body>
</html>
